<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>URL ë‹¨ì¶•ê¸° - Marketing</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <style>
    .copy-feedback {
      display: none;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .copy-feedback.show {
      display: inline;
      opacity: 1;
    }
    .glass {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(200, 200, 200, 0.3);
    }
    
  </style>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
    window.createClient = createClient; // windowì— ë¶™ì—¬ì„œ globalì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ
  </script>

</head>
  
<body class="bg-gradient-to-br from-indigo-100 via-white to-blue-100 flex flex-col min-h-screen font-sans">
  <nav class="bg-white bg-opacity-90 shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <a href="index.html">
        <img src="ë¡œê³ .png" alt="ë¡œê³ " class="h-8">
      </a>
      <ul id="menu" class="hidden flex-col md:flex md:flex-row space-y-4 md:space-y-0 space-x-0 md:space-x-6">
        <li><a href="url-cut.html" class="text-gray-700 hover:text-indigo-600 font-medium transition active-menu">URL ë‹¨ì¶•ê¸°</a></li>
        <li><a href="dashboard.html" class="text-gray-700 hover:text-indigo-600 font-medium transition">URL ëŒ€ì‹œë³´ë“œ</a></li>
      </ul>
      <button id="menu-toggle" class="md:hidden text-gray-600 focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </nav>

  <main class="flex-grow container mx-auto px-4 py-10 max-w-xl">
    <div class="mb-8 text-center">
      <h2 class="text-3xl md:text-4xl font-extrabold text-indigo-700 animate__animated animate__fadeInUp">ğŸš€ ë§ˆì¼€í„°ë¥¼ ìœ„í•œ ìŠ¤ë§ˆíŠ¸í•œ ë§í¬ ë‹¨ì¶•ê¸°</h2>
      <p class="text-gray-600 mt-2 animate__animated animate__fadeInUp animate__delay-1s">ìº í˜ì¸ ê´€ë¦¬, í´ë¦­ ì¶”ì , ê³ ê° ì „í™˜ì„ ìœ„í•œ ìµœì ì˜ ë„êµ¬!</p>
    </div>

    <div class="glass p-8 rounded-2xl shadow-xl">
      <h1 class="text-4xl font-bold mb-6 text-center text-indigo-700 flex justify-center items-center">
        <span id="typewriter"></span><span id="cursor">|</span>
      </h1>
      <div class="mb-6">
        <label class="block mb-2 text-gray-700 font-medium">ğŸ”— URL ì…ë ¥</label>
        <div class="flex rounded-lg shadow-sm overflow-hidden">
          <input id="url-input" type="url" placeholder="https://example.com" class="flex-grow px-4 py-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 rounded-l-lg">
          <button id="shorten-btn" class="px-5 py-3 bg-gradient-to-r from-indigo-500 to-blue-500 text-white font-semibold rounded-r-lg hover:scale-105 transform transition-all duration-200">
            ë‹¨ì¶•
          </button>
        </div>
      </div>
      <div id="result-container" class="hidden mt-6">
        <label class="block mb-2 text-gray-700 font-medium">ğŸ‰ ìƒì„±ëœ ë‹¨ì¶• URL</label>
        <div class="flex items-center bg-indigo-50 border border-indigo-200 p-4 rounded-lg shadow-lg space-x-3">
          <a id="short-url" href="#" target="_blank" class="text-indigo-600 font-medium break-all"></a>
          <button id="copy-btn" class="flex items-center gap-1 px-3 py-1 text-sm bg-indigo-500 text-white border border-indigo-600 rounded hover:bg-indigo-600 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16h8M8 12h8m-6-4h6"></path></svg>
            ë³µì‚¬
          </button>
          <span id="copy-feedback" class="copy-feedback text-sm text-indigo-600 animate__animated animate__fadeIn">âœ” ë³µì‚¬ ì™„ë£Œ!</span>
          <p id="click-count" class="text-sm text-gray-500 mt-2">ğŸ‘ï¸ í´ë¦­ ìˆ˜: <span>0</span></p>
        </div>
        <div id="dashboard-link" style="display:none; margin-top:15px;">
          <p class="text-green-600 font-bold mb-2">ğŸ‰ ë‹¨ì¶• ì™„ë£Œ!</p>
          <a href="dashboard.html" class="cta-button">ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸í•˜ê¸°</a>
        </div>
      </div>
    </div>
  </main>

  <footer class="bg-gray-200 text-center p-4 mt-auto">
    <p class="text-sm text-gray-600">Â© 2025 Hobaek Marketing. All Rights Reserved.</p>
  </footer>
  
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const urlInput = document.getElementById('url-input');
      const shortenBtn = document.getElementById('shorten-btn');
      const resultContainer = document.getElementById('result-container');
      const shortUrlElement = document.getElementById('short-url');
      const copyBtn = document.getElementById('copy-btn');
      const copyFeedback = document.getElementById('copy-feedback');
      const supabase = createClient('https://azdnwqrirgpedwcuaqdi.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6ZG53cXJpcmdwZWR3Y3VhcWRpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4MDU4NTIsImV4cCI6MjA2MzM4MTg1Mn0.wpsdKaG0XWwWRXrXVHzwliZ99EYjvHpAizqQbu5djn8');

      // ë¸Œë¼ìš°ì €ì— ìµëª… ì‚¬ìš©ì ID ì €ì¥
      let anonymousId = localStorage.getItem('anonymous_id');
      if (!anonymousId) {
        anonymousId = crypto.randomUUID(); // ê³ ìœ  ID ìƒì„±
        localStorage.setItem('anonymous_id', anonymousId);
      }
    
      async function shortenUrl() {
        console.log("âœ… shortenUrl í•¨ìˆ˜ ì‹¤í–‰ë¨");
        document.getElementById('dashboard-link').style.display = 'none';
        const originalUrl = urlInput.value.trim();
        if (!originalUrl || !/^https?:\/\//.test(originalUrl)) {
          alert("ìœ íš¨í•œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        console.log("anonymousId:", anonymousId);

        const res = await fetch('/.netlify/functions/shorten', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ originalUrl, anonymousId })
        });
    
        if (!res.ok) {
          const errData = await res.json();
          console.error("ì„œë²„ ì˜¤ë¥˜ ì‘ë‹µ:", errData);
          alert("ë‹¨ì¶• ì‹¤íŒ¨: " + (errData.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
          return;
        }

        const data = await res.json();
        console.log("ë‹¨ì¶• ì„±ê³µ ì‘ë‹µ:", data);
        const shortUrl = `${window.location.origin}/r/${data.shortCode}`;

        shortUrlElement.textContent = shortUrl;
        shortUrlElement.href = shortUrl;
        fetchClickCount(data.shortCode);
        shortUrlElement.setAttribute('target', '_blank');
        shortUrlElement.setAttribute('rel', 'noopener noreferrer'); // ë³´ì•ˆ ê°•í™”
        resultContainer.classList.remove('hidden');
        document.getElementById('dashboard-link').style.display = 'block';
      }

      function copyToClipboard() {
        navigator.clipboard.writeText(shortUrlElement.textContent).then(() => {
          copyFeedback.classList.add('show');
          setTimeout(() => copyFeedback.classList.remove('show'), 2000);
        });
      }

      async function fetchClickCount(shortCode) {
        const res = await fetch('/.netlify/functions/get-clicks', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ shortCode })
        });
  
        if (!res.ok) return;
  
        const data = await res.json();
        const countElement = document.getElementById('click-count');
        const container = document.getElementById('click-count-container');
  
        countElement.textContent = data.count || 0;
        container.classList.remove('hidden');
      }
  
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      shortenBtn.addEventListener('click', shortenUrl);
      copyBtn.addEventListener('click', copyToClipboard);
      urlInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') shortenUrl();
      });
    });
  </script>

  <script>
    // --- í™œì„± ë©”ë‰´ í‘œì‹œ ìŠ¤í¬ë¦½íŠ¸ (ì¶”ê°€ëœ ë¶€ë¶„) ---
    document.addEventListener('DOMContentLoaded', function() {
      // í˜„ì¬ ì›¹í˜ì´ì§€ ì£¼ì†Œì—ì„œ íŒŒì¼ ì´ë¦„ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤. (ì˜ˆ: "index.html", "notice-tool.html")
      const currentPath = window.location.pathname.split('/').pop();
      const menuLinks = document.querySelectorAll('#menu a'); // ë©”ë‰´ ì•ˆì˜ ëª¨ë“  ë§í¬(<a>)ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
  
      menuLinks.forEach(link => {
        // ê° ë§í¬ê°€ ì—°ê²°ëœ ì£¼ì†Œ(href ì†ì„±)ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const linkPath = link.getAttribute('href');
  
        // ë§í¬ ì£¼ì†Œì™€ í˜„ì¬ í˜ì´ì§€ íŒŒì¼ ì´ë¦„ì´ ê°™ìœ¼ë©´, ê·¸ ë§í¬ì— 'active-menu' ìŠ¤íƒ€ì¼ì„ ì ìš©í•©ë‹ˆë‹¤.
        if (linkPath && linkPath === currentPath) {
          link.classList.add('active-menu');
        }
        // ë§Œì•½ í™ˆí˜ì´ì§€(index.html)ì¸ë° ì£¼ì†Œê°€ ê·¸ëƒ¥ '/' ë¡œ ëë‚˜ëŠ” ê²½ìš°ë„ ì²˜ë¦¬
        else if (currentPath === '' && linkPath === 'index.html') {
          link.classList.add('active-menu');
        }
      });
  
      // --- ë©”ë‰´ í† ê¸€ ---
      const toggleBtn = document.getElementById('menu-toggle');
      const menu = document.getElementById('menu');
      if (toggleBtn && menu) {
        toggleBtn.addEventListener('click', function () {
          menu.classList.toggle('menu-open');
        });
      }
  
      // âœ¨ ì…ë ¥ì°½ ìë™ í¬ì»¤ìŠ¤ & ì´ˆê¸°í™” (ì¡´ì¬í•  ë•Œë§Œ ì‹¤í–‰)
      const urlInput = document.getElementById('url-input');
      if (urlInput) {
        urlInput.focus();
        urlInput.value = '';
      }
    });
  </script>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    const text = "âœ¨ URLì„ ì§§ê³  ì„¸ë ¨ë˜ê²Œ";
    const typewriter = document.getElementById("typewriter");
    const cursor = document.getElementById("cursor");
    let i = 0;
  
    function type() {
      if (i <= text.length) {
        typewriter.textContent = text.slice(0, i);
        i++;
        setTimeout(type, 90); // íƒ€ì´í•‘ ì†ë„ (ì›í•˜ë©´ ìˆ«ì ì¡°ì •)
      } else {
        cursor.style.display = "inline"; // ì»¤ì„œ ê³„ì† ê¹œë¹¡ì„
      }
    }
  
    type();
  });
  </script>

</body>
</html>
