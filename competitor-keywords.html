<!DOCTYPE html>
<html lang="ko">
<head>
    <title>경쟁사 키워드 트렌드 추적기</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
    html {
      scroll-behavior: smooth;
    }
    </style>
</head>

<body>
<!-- 헤더 영역 -->
<div id="menu-container"></div>
    
  <section class="max-w-xl mx-auto text-center py-16">
    <h1 class="text-3xl font-bold text-indigo-600 mb-6">경쟁사 키워드 트렌드 추적기</h1>
    <p class="mb-8 text-gray-600">브랜드명을 입력하면 뉴스 데이터를 분석해 자주 등장하는 키워드를 보여줍니다.</p>

    <input type="text" id="brandInput" placeholder="예: 삼성전자, 마켓컬리" class="border px-4 py-2 w-2/3 rounded mb-4">
    <br>
    <button onclick="analyzeKeywords()" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">분석하기</button>

    <canvas id="keywordChart" class="mt-10 w-full max-w-md mx-auto"></canvas>
  </section>

<!-- 푸터 영역 -->
<div id="footer-placeholder"></div>
    
<!-- JS 연결 -->
<script src="public/js/loadMenu.js" defer></script>
<script src="public/js/loadFooter.js" defer></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('brandInput');

    input.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        analyzeKeywords();
      }
    });

    window.analyzeKeywords = function () {
      const brand = input.value.trim();
      if (!brand) return alert("브랜드명을 입력해주세요!");

      console.log("✅ 분석 시작: ", brand);

      fetch(`/.netlify/functions/getKeywords?keyword=${encodeURIComponent(brand)}`)
        .then(res => res.json())
        .then(data => {
          console.log("📦 서버 응답 결과:", data);

          if (!data || !Array.isArray(data.keywords)) {
            alert("서버에서 유효한 데이터를 받지 못했습니다.");
            return;
          }

          const labels = data.keywords.map(k => k[0]);
          const counts = data.keywords.map(k => k[1]);

          console.log("🧪 키워드 목록:", labels);

          if (!labels.length) {
            alert("분석된 키워드가 없습니다.");
            return;
          }

          const chartCanvas = document.getElementById('keywordChart');
          const ctx = chartCanvas.getContext('2d');

          // 기존 차트 제거
          if (window.keywordChart) window.keywordChart.destroy();

          window.keywordChart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: labels,
              datasets: [{
                label: '등장 빈도',
                data: counts,
                backgroundColor: 'rgba(99, 102, 241, 0.6)',
                borderRadius: 6
              }]
            },
            options: {
              responsive: true,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    precision: 0 // 소수점 제거
                  }
                }
              }
            }
          });
        })
        .catch(err => {
          console.error("❌ fetch 실패:", err);
          alert("분석 중 오류가 발생했습니다.");
        });
    };
  });
</script>
    
</body>
</html>
